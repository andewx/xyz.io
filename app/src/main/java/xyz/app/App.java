/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package xyz.app;

import io.javalin.Javalin;
import io.javalin.http.Handler;
import io.javalin.http.staticfiles.Location;
import xyz.controllers.*;
import xyz.dbkit.DBMain;

import java.io.File;
import java.io.IOException;


public class App {
    public static void main(String[] args) throws IOException {



        //Initiate Controllers - Form API
        Javalin app = Javalin.create();
        app.config.addStaticFiles("/web");
        app.start(8080);
        DBMain myDB = new DBMain("xyz-db");



        myDB.start();
        RouteManager routerGet = new RouteManager();
        RouteManager routerPost = new RouteManager();
        BaseController BaseEndpoint = new BaseController(myDB);
        IndexController IndexEndpoint = new IndexController(myDB, routerGet );
        UserController userController = new UserController(myDB, myDB.GetNode("Users"), routerGet);
        ModelsController modelController = new ModelsController(myDB);


        //Build API
        routerGet.Register("/", IndexEndpoint::Index);
        routerGet.Register("/users", userController::main);
        routerGet.Register("/model/create/:name", modelController::ModelCreateForm);
        routerGet.Register("/model/edit/:name/:id", modelController::ModelEditForm);
        routerGet.Register("/model/delete/:name/:id", modelController::Delete);

        routerPost.Register("/model/user_submit/:name", modelController::ModelCreate);
        routerPost.Register("/model/edit-response/:name/:id", modelController::ModelEdit);


        //Add Routing to Javalin
        for (String key : routerGet.RouteMethods.keySet()){
            Handler method = routerGet.getHandler(key);
            app.get(key, method);
        }

        for (String key : routerPost.RouteMethods.keySet()){
            Handler method = routerPost.getHandler(key);
            app.post(key, method);
        }


    }
}
